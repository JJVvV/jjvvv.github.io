<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="考题最近遇到一道面试题  new Human(‘小明’).sleep(3).go(‘home’).eat(‘apple’).sleep(2).eat(‘apple 2’)输出// I am 小明// waiting: sleep for 3s// go home// eat an apple// waiting: sleep for 2s// eat an apple 2  解析这道题的难点在于"><meta name="keywords" content="sleep,interview"><meta property="og:type" content="article"><meta property="og:title" content="一道关于 sleep 的考题"><meta property="og:url" content="https://jjvvv.github.io/2019/02/27/一道关于-sleep-的考题/index.html"><meta property="og:site_name" content="Alex"><meta property="og:description" content="考题最近遇到一道面试题  new Human(‘小明’).sleep(3).go(‘home’).eat(‘apple’).sleep(2).eat(‘apple 2’)输出// I am 小明// waiting: sleep for 3s// go home// eat an apple// waiting: sleep for 2s// eat an apple 2  解析这道题的难点在于"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2019-04-27T07:30:17.904Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="一道关于 sleep 的考题"><meta name="twitter:description" content="考题最近遇到一道面试题  new Human(‘小明’).sleep(3).go(‘home’).eat(‘apple’).sleep(2).eat(‘apple 2’)输出// I am 小明// waiting: sleep for 3s// go home// eat an apple// waiting: sleep for 2s// eat an apple 2  解析这道题的难点在于"><link rel="shortcut icon" href="/images/avatar_s.png"><link rel="icon" type="image/png" href="/images/avatar_s.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/avatar_s.png"><title>一道关于 sleep 的考题</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/rtl.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css"></head><body class="max-width mx-auto px3 ltr"><div id="header-post"><a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a><a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a><a id="top-icon-tablet" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fas fa-chevron-up fa-lg"></i></a><span id="menu"><span id="nav"><ul><li> <a href="/">Home</a></li><li> <a href="/archives/">Writing</a></li><li> <a href="/categories/">Categories</a></li><li> <a href="/tags/">Tags</a></li><li> <a href="/about/">About</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="/2019/03/01/一些CSS属性总结/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" href="/2019/01/22/前端常见问题面试题总结/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul> <span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://jjvvv.github.io/2019/02/27/一道关于-sleep-的考题/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https://jjvvv.github.io/2019/02/27/一道关于-sleep-的考题/&text=一道关于 sleep 的考题"><i class="fab fa-twitter" aria-hidden="true"></i></a></li></ul></div><div id="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#考题"><span class="toc-number">1.</span> <span class="toc-text">考题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解析"><span class="toc-number">2.</span> <span class="toc-text">解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现"><span class="toc-number">3.</span> <span class="toc-text">实现</span></a></li></ol></div></span></div><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline"> 一道关于 sleep 的考题</h1><div class="meta"> <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Alex</span></span><div class="postdate"> <time datetime="2019-02-27T02:38:20.000Z" itemprop="datePublished">2019-02-27</time> (Updated: <time datetime="2019-04-27T07:30:17.904Z" itemprop="dateModified">2019-04-27</time>)</div><div class="article-category"><i class="fas fa-archive"></i> <a class="category-link" href="/categories/FrontEnd/">FrontEnd</a></div><div class="article-tag"><i class="fas fa-tag"></i> <a class="tag-link" href="/tags/interview/">interview</a>, <a class="tag-link" href="/tags/sleep/">sleep</a></div></div></header><div class="content" itemprop="articleBody"><h2 id="考题"><a href="#考题" class="headerlink" title="考题"></a>考题</h2><p>最近遇到一道面试题</p><blockquote><p>new Human(‘小明’).sleep(3).go(‘home’).eat(‘apple’).sleep(2).eat(‘apple 2’)<br>输出<br>// I am 小明<br>// waiting: sleep for 3s<br>// go home<br>// eat an apple<br>// waiting: sleep for 2s<br>// eat an apple 2</p></blockquote><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>这道题的难点在于 <code>sleep</code> 方法。</p><p>常见的 <code>sleep</code> 方式实现：</p><p><a href="https://jsfiddle.net/drowning/covpjyrq/2/" target="_blank" rel="noopener">live demo</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">time</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, time);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"start"</span>);</span><br><span class="line">  <span class="keyword">await</span> sleep(<span class="number">3000</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"end"</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>题目中的调用方式是链式调用，如果要做到 sleep，则需要把所有调用的方法进行收集，等待 sleep 之后再调用堆栈中的下一项。所以，我们把在方法内构造一个匿名函数，然后将函数 push 进堆栈，等待之后调用。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p><a href="https://jjvvv.github.io/dailyJS/sleep/sleep.html">live demo</a></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Human &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  tasks: <span class="built_in">any</span>[];</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.tasks = [];</span><br><span class="line">    <span class="keyword">this</span>.say(<span class="string">"I am "</span> + <span class="keyword">this</span>.name);</span><br><span class="line">    <span class="keyword">this</span>.start();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  start() &#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      that.runNext();</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  say(what) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(what);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addTask(fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(fn);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  runNext() &#123;</span><br><span class="line">    <span class="keyword">const</span> task = <span class="keyword">this</span>.tasks.shift();</span><br><span class="line">    task &amp;&amp; task();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  sleep(time) &#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">const</span> anon = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"waiting: sleep for "</span> + time);</span><br><span class="line">      setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        that.runNext();</span><br><span class="line">      &#125;, time * <span class="number">1000</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.addTask(anon);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  go(where) &#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">const</span> anon = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      that.say(<span class="string">"go "</span> + where);</span><br><span class="line">      that.runNext();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.addTask(anon);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  eat(what) &#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">const</span> anon = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      that.say(<span class="string">"Eat an "</span> + what);</span><br><span class="line">      that.runNext();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.addTask(anon);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> aa = <span class="keyword">new</span> Human(<span class="string">"小明"</span>)</span><br><span class="line">  .sleep(<span class="number">3</span>)</span><br><span class="line">  .go(<span class="string">"home"</span>)</span><br><span class="line">  .eat(<span class="string">"apple"</span>)</span><br><span class="line">  .sleep(<span class="number">2</span>)</span><br><span class="line">  .eat(<span class="string">"apple too"</span>);</span><br></pre></td></tr></table></figure><p>上边的实现虽然满足了要求，但是代码却很多重复，我们 <code>decorator</code> 进行重构下：</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">taskDecorator</span>(<span class="params">autoNext</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target, name, descriptor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (descriptor) &#123;</span><br><span class="line">      <span class="keyword">const</span> oldValue = descriptor.value;</span><br><span class="line"></span><br><span class="line">      descriptor.value = <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">const</span> newValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">const</span> ret = oldValue.apply(</span><br><span class="line">            that,</span><br><span class="line">            args.concat(that.runNext.bind(that))</span><br><span class="line">          );</span><br><span class="line">          <span class="keyword">if</span> (autoNext) &#123;</span><br><span class="line">            that.runNext();</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.addTask(newValue);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> descriptor;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Human &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  tasks: <span class="built_in">any</span>[];</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.tasks = [];</span><br><span class="line">    <span class="keyword">this</span>.say(<span class="string">"I am "</span> + <span class="keyword">this</span>.name);</span><br><span class="line">    <span class="keyword">this</span>.start();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  start() &#123;</span><br><span class="line">    <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      that.runNext();</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  say(what) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(what);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addTask(fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tasks.push(fn);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  runNext() &#123;</span><br><span class="line">    <span class="keyword">const</span> task = <span class="keyword">this</span>.tasks.shift();</span><br><span class="line">    task &amp;&amp; task();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@taskDecorator</span>(<span class="literal">false</span>)</span><br><span class="line">  sleep(time, next?) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"waiting: sleep for "</span> + time);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      next &amp;&amp; next();</span><br><span class="line">    &#125;, time * <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@taskDecorator</span>(<span class="literal">true</span>)</span><br><span class="line">  go(where) &#123;</span><br><span class="line">    <span class="keyword">this</span>.say(<span class="string">"go: "</span> + where);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@taskDecorator</span>(<span class="literal">true</span>)</span><br><span class="line">  eat(what) &#123;</span><br><span class="line">    <span class="keyword">this</span>.say(<span class="string">"Eat an "</span> + what);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> aa = <span class="keyword">new</span> Human(<span class="string">"jack"</span>)</span><br><span class="line">  .sleep(<span class="number">3</span>)</span><br><span class="line">  .go(<span class="string">"home"</span>)</span><br><span class="line">  .eat(<span class="string">"apple"</span>)</span><br><span class="line">  .sleep(<span class="number">2</span>)</span><br><span class="line">  .eat(<span class="string">"apple too"</span>);</span><br></pre></td></tr></table></figure><p>我们提取了 <code>@taskDecorator</code> 装饰器，用于装饰需要添加到任务队列的方法。装饰器支持一个参数，告诉装饰器是否自动调用 <code>runNext</code> 方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">descriptor.value = <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">const</span> newValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> ret = oldValue.apply(that, args.concat(that.runNext.bind(that)));</span><br><span class="line">    <span class="keyword">if</span> (autoNext) &#123;</span><br><span class="line">      that.runNext();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.addTask(newValue);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>对不自动调用的方法，提供了参数注入的形式，注入到方法的最后一个参数上：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ret = oldValue.apply(that, args.concat(that.runNext.bind(that)));</span><br></pre></td></tr></table></figure></div></article><div class="blog-post-comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments.</noscript></div></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li> <a href="/">Home</a></li><li> <a href="/archives/">Writing</a></li><li> <a href="/categories/">Categories</a></li><li> <a href="/tags/">Tags</a></li><li> <a href="/about/">About</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#考题"><span class="toc-number">1.</span> <span class="toc-text">考题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解析"><span class="toc-number">2.</span> <span class="toc-text">解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现"><span class="toc-number">3.</span> <span class="toc-text">实现</span></a></li></ol></div><div id="share-footer" style="display:none"><ul><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://jjvvv.github.io/2019/02/27/一道关于-sleep-的考题/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https://jjvvv.github.io/2019/02/27/一道关于-sleep-的考题/&text=一道关于 sleep 的考题"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a><a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a><a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></div></div></div><footer id="footer"><div class="footer-left"> Copyright &copy; 2019 Alex Liu</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archives/">Writing</a></li><li><a href="/categories/">Categories</a></li><li><a href="/tags/">Tags</a></li><li><a href="/about/">About</a></li></ul></nav></div></footer></div><script src="/lib/jquery/jquery.min.js"></script><script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script><script src="/js/main.js"></script><script type="text/javascript">var disqus_shortname="jjvvv";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script></body></html>